<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Työajanhallintasovellus</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<script>
    $(document).ready(function () {

        fetchTimes();

        /*
        $('#results').html("<tr><th>Aloitusaika</th><th>Lopetusaika</th></tr>");
        $.get("http://localhost:3002/times").done(function (data, status) {
            $.each(data, function (i, item) {
                var $tr = $('<tr>').append(
                    $('<td>').text("Aloitusaika " + item.aloitus),
                    $('<td>').text("Lopetusaika " + item.lopetus)
                ).appendTo("#results");
            })
        })

    })
    */

        // Laskee tuntien erotuksen kahdesta päivämäärästä
        function calculateHours($pvm1, $pvm2) {
            var hours = Math.abs($pvm2 - $pvm1) / 36e5;
            return hours;
    }

        // Hakee tietokannasta tunnit tauluun
        function fetchTimes() {
            $("#tresults").empty();
            $('#tresults').html("<tr><th>Aloitusaika</th><th>Lopetusaika</th><th>Tunnit</th></tr>");
            $.getJSON("http://127.0.0.1:3002/times", function (data) {
                        var len = data.length;
                        for (var i = 0; i < len; i++) {
                            var $pvm1 = new Date (data[i].aloitus);
                            var $pvm2 = new Date (data[i].lopetus);
                            var hours = calculateHours($pvm1, $pvm2);
                            $("#tresults").append(
                                "<tr>" +
                                "<td>" + data[i].aloitus + "</td>" +
                                "<td>" + data[i].lopetus + "</td>" +
                                "<td>" + hours + "</td>" +
                                "</tr>"
                            )
                        }

                    
                    });
        };

        $("#btnAddTime").click(function (){
            $(".chsWorker").empty();
            getWorkers();
            $("#timedialog").dialog();
        })


        $("#startingDatepicker").datepicker();
        $("#endingDatepicker").datepicker();

        function getWorkers() {
            $.get("http://localhost:3002/workers", function (data, status) {
                var $option = $('<option>').text("Valitse...").appendTo('.chsWorker');
                $.each(data, function (i, item) {
                    var $option = $('<option>').text(item.nimi).val(item.tyontekijaID).appendTo('.chsWorker');
                })
            }) 
        }
        

    })
</script>


<body>
    <div id="timediv">
    
        <br>
    
        <table id="tresults"></table>
        <br>
        <button id="btnAddTime" type="button" class="btn btn-primary">Lisää suoriteaika</button>
    </div>
    
    <div id="timedialog" title="Lisää työsuoritus" style="display:none">

            <label for "chooseProject">Valitse projekti: </label>
            <select id="chooseProject">
                <option class="chsProject"></option>
            </select>
            <br>
            <label for "chooseWorker">Valitse työntekijä: </label>
            <select id="chooseWorker">
                <option class="chsWorker"></option>
            </select>
            <br>
            Alkamisaika:
            <br>
            <br>
            <p>Päivämäärä: <input type="text" id="startingDatepicker" size="15"></p>
            <p>Kello: <input type='time' id="startingTime"/></p>
            <br>
            Päättymisaika:
            <br>
            <br>
            <p>Päivämäärä: <input type="text" id="endingDatepicker" size="15"></p>
            <p>Kello: <input type='time' id="endingTime"/></p>
            <button id="sendTime" class="btn btn-primary">Lisää</button>

    
    </div>
</body>

</html>